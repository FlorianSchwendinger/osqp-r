OSQP_LIB_DIR=./osqp_lib
OSQP_STATIC_LIB=$(OSQP_LIB_DIR)/libosqpstatic.a
OSQP_INCLUDES= ./osqp_sources/include

PKG_CXXFLAGS = -I$(OSQP_INCLUDES)

OBJECTS= $(OSQP_STATIC_LIB) osqp_solve_interface.o RcppExports.o

CXX_STD=CXX11

.PHONY: all

all: $(SHLIBS)

$(SHLIBS) : $(OSQP_STATIC_LIB)

$(OSQP_STATIC_LIB):

		# The OSQP static library should already exist and
 		# be in the correct place if we are building via cmake.
		# If we find ourselves without cmake installed (e.g. because the
		# package is being built in the CRAN servers), then we have
		# a go at building the static library here.

		(cd $(OSQP_LIB_DIR) && $(MAKE) \
		CC="$(CC)" CFLAGS="$(CFLAGS) $(CPICFLAGS)" \
		ARFLAGS="$(ARFLAGS)" AR="$(AR)" RANLIB="$(RANLIB)" \
		&& $(MAKE) clean)
